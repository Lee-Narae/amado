<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="JH">

<!-- #88. 댓글쓰기 (tbl_comment 테이블에 insert) -->
	<insert id="addComment" parameterType="FleamarketCommentVO">
		insert into tbl_fleamarketcomment(fleamarketcommentseq, fleamarketseq, comment_text, registerdate, fk_userid)
		values(seq_fleamarketcomment.nextval, 1, #{comment_text}, default, #{fk_userid})
	</insert>
	
	<!-- #89-1. tbl_board 테이블에 commentCount 컬럼이 1증가(update) -->
	<update id="updateCommentCount" parameterType="String">
		update tbl_fleamarket set commentcount = commentcount+1
		where fleamarketseq = 1
	</update>
	
	<!-- === #93. 원게시물에 딸린 댓글들을 조회해오기 === -->
    <!-- 첨부파일이 없는 경우  -->
    <select id="getCommentList" parameterType="String" resultType="FleamarketCommentVO">
		select fleamarketcommentseq, fk_userid, comment_text, changestatus
		     , to_char(registerdate, 'yyyy-mm-dd hh24:mi:ss') AS registerdate
             , V.memberimg
		from tbl_fleamarketcomment A join tbl_member V
		ON A.fk_userid = V.userid
		where A.fleamarketseq = #{parentSeq}
		order by fleamarketcommentseq desc
    </select>


	<update id="updateComment" parameterType="HashMap">
        update tbl_fleamarketcomment set comment_text = #{comment_text}, registerdate = sysdate, changestatus = 1
        where fleamarketcommentseq = #{fleamarketcommentseq}
    </update>

    <delete id="deleteComment" parameterType="String">
        delete from tbl_fleamarketcomment
        where fleamarketcommentseq = #{fleamarketcommentseq}
    </delete>
    
    <update id="updateCommentCount_decrease" parameterType="String">
        update tbl_fleamarket set commentcount = commentcount - 1 
        where fleamarketseq = #{fleamarketseq}
    </update>


	<select id="getCommentreList" parameterType="String" resultType="FleamarketCommentReVO">
		select fleamarketcommentreplyseq, fk_userid, commentreply_text, changestatus
		     , to_char(registerdate, 'yyyy-mm-dd hh24:mi:ss') AS registerdate
             , V.memberimg
		from tbl_fleamarketcommentreply A join tbl_member V
		ON A.fk_userid = V.userid
		where A.fleamarketcommentseq = #{fleamarketcommentseq}
		order by fleamarketcommentreplyseq desc
    </select>

	<insert id="addReComment" parameterType="FleamarketCommentReVO">
		insert into tbl_fleamarketcommentreply(fleamarketcommentreplyseq, fleamarketcommentseq, commentreply_text, fk_userid)
		values(seq_fleamarketcommentreplyseq.nextval, #{fleamarketcommentseq}, #{commentreply_text}, #{fk_userid})
	</insert>
	
	<update id="updateReCommentCount" parameterType="String">
		update tbl_fleamarketcomment set recommentcount = recommentcount+1
		where fleamarketcommentseq = #{fleamarketcommentseq}
	</update>
	
	<update id="updateReComment" parameterType="HashMap">
        update tbl_fleamarketcommentreply set commentreply_text = #{commentreply_text}, registerdate = sysdate, changestatus = 1
        where fleamarketcommentreplyseq = #{fleamarketcommentreplyseq}
    </update>
    
    <delete id="deleteReComment" parameterType="String">
        delete from tbl_fleamarketcommentreply
        where fleamarketcommentreplyseq = #{fleamarketcommentreplyseq}
    </delete>
    
    <update id="updateReCommentCount_decrease" parameterType="String">
        update tbl_fleamarketcomment set recommentcount = recommentcount - 1 
        where fleamarketcommentseq = #{fleamarketcommentseq}
    </update>
    
    <select id="getMyClub" resultType="ClubVO" parameterType="HashMap">
		select clubseq, clubname, clubimg, fk_sportseq, fk_userid, clubtel, city, local, clubgym, clubtime, membercount, clubpay, clubstatus, clubscore, viewcount
		from tbl_club
		where clubseq = #{clubseq}
	</select>

	<update id="updateviewcount" parameterType="String">
		update tbl_club set viewcount = viewcount+1
		where clubseq = #{clubseq}
	</update>
	
	<select id="getmatchingList" resultType="MatchingVO" parameterType="String">
		SELECT m.matchingseq, m.result1, m.result2, m.clubseq1, m.clubseq2, m.score1, m.score2, c1.clubname AS clubname1, c2.clubname AS clubname2, r.area, to_char(r.matchdate, 'YYYY-MM-DD') AS matchdate
		FROM tbl_matching m
		JOIN tbl_club c1 ON m.clubseq1 = c1.clubseq
		JOIN tbl_club c2 ON m.clubseq2 = c2.clubseq
		JOIN tbl_matchingreg r ON m.matchingregseq = r.matchingregseq
		where m.clubseq2 = #{clubseq} or m.clubseq1 = #{clubseq}
		order by matchingseq desc
	</select>
	
	<select id="getGymAdd" resultType="GymVO">
		select lng, lat
		from tbl_gym
	</select>
	
	
</mapper>